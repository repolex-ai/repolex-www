---
layout: blog-sidebar
---

<div class="post-with-toc">
    <article class="post-content">
        <h1>{{ page.title }}</h1>
        <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%B %-d, %Y" }}</time>

        <div class="content">
            {{ content }}
        </div>
    </article>

    <aside class="toc-sidebar">
        <div class="toc-sticky">
            <h4>Contents</h4>
            <div id="toc-container"></div>
        </div>
    </aside>
</div>

<script>
// Generate TOC from h2 and h3 elements
document.addEventListener('DOMContentLoaded', function() {
    const article = document.querySelector('.post-content .content');
    const tocContainer = document.getElementById('toc-container');

    if (!article || !tocContainer) return;

    const headings = article.querySelectorAll('h2, h3');

    if (headings.length === 0) {
        // No headings, hide TOC
        document.querySelector('.toc-sidebar').style.display = 'none';
        return;
    }

    const toc = document.createElement('ul');
    toc.className = 'toc-list';

    let currentH2 = null;

    headings.forEach((heading, index) => {
        // Add ID to heading for linking
        if (!heading.id) {
            heading.id = 'heading-' + index;
        }

        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = '#' + heading.id;
        a.textContent = heading.textContent;
        a.className = 'toc-link';

        li.appendChild(a);

        if (heading.tagName === 'H2') {
            li.className = 'toc-h2';
            toc.appendChild(li);
            currentH2 = li;
        } else if (heading.tagName === 'H3') {
            li.className = 'toc-h3';

            // Nest under current h2
            if (currentH2) {
                let sublist = currentH2.querySelector('ul');
                if (!sublist) {
                    sublist = document.createElement('ul');
                    sublist.className = 'toc-sublist';
                    currentH2.appendChild(sublist);
                }
                sublist.appendChild(li);
            } else {
                toc.appendChild(li);
            }
        }
    });

    tocContainer.appendChild(toc);

    // Smooth scroll
    document.querySelectorAll('.toc-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });
});
</script>
